\NeedsTeXFormat{LaTeX2e}[1994/12/01]
\ProvidesPackage{esc-handbook}[2004/12/09 Marcel Oliver]

 % LaTeX macros for typesetting course descriptions and student
 % handbooks for the School of Engineering and Science at
 % International University Bremen.
 %
 % Marcel Oliver, December 2004
 %
 % The page style code is adapted from esadoc.sty by Patrick W. Daly
 % (copyright notice below).
 % 
 %-------------------------------------------------------------------
 % NOTICE:
 % This file may be used for non-profit purposes.
 % It may not be distributed in exchange for money,
 %   other than distribution costs.
 %
 % The author provides it `as is' and does not guarantee it in any way.
 %
 % Copyright (C) 1994-1998 Patrick W. Daly
 % Max-Planck-Institut f\"ur Aeronomie
 % Max-Planck_Str. 2
 % D-37191 Katlenburg-Lindau
 % Germany
 %
 % E-mail: daly@linmpi.mpg.de
 %-----------------------------------------------------------

\RequirePackage{color} 
\RequirePackage{html}

\newif\ifshowresources
\newif\ifshowcurrent
\newif\ifshowprevious
\DeclareOption{showresources}{\showresourcestrue}
\DeclareOption{showcurrent}{\showcurrenttrue}
\DeclareOption{showprevious}{\showprevioustrue}
\ProcessOptions\relax

\def\shorttitle#1{\gdef\@shorttitle{#1}} % The (short) title on each page
\def\issue#1{\gdef\@issue{#1}}           % The issue number
\def\revision#1{\gdef\@revision{#1}}     % The revision number
\def\docurl#1{\gdef\@docurl{#1}}         % URL of document
\def\logo#1{\gdef\@logo{#1}}             % Logo for title page

\def\@shorttitle{}
\def\@docissue{}
\def\@docrevision{}
\def\@docurl{}
\def\@masterfile{}
\def\@logo{}

%\newcommand{\link}[1]{\htmladdnormallink{\texttt{#1}}{#1}}
\newcommand{\link}[1]{\href{#1}{\texttt{#1}}}

% hyperref.sty seriously messes up the contentsline mechanism.
% We have to resort to the original LaTeX definitions for the
% following to work...
%
% old definition of \addcontentsline from latex.ltx
\def\oldaddcontentsline#1#2#3{%
  \addtocontents{#1}{\protect\oldcontentsline{#2}{#3}{\thepage}}}
% old definition of \contentsline from latex.ltx
\def\oldcontentsline#1{\csname l@#1\endcsname}

\newcommand\masterfile[1]{%
  \gdef\@masterfile{#1}%
  \oldaddcontentsline{rev}{masterfile}{#1}
  \AtEndDocument{\null\oldaddcontentsline{rev}{revclose}{}}}

\newcommand\l@masterfile[2]{%
  \begin{center}
    \begin{tabular}{|c|c|l|p{8cm}|}
      \hline
      \multicolumn{4}{|l|}{Maintained by: \@author} \\
      \hline
      \multicolumn{4}{|l|}{Short Document Title:
                           \textbf{\@shorttitle}} \\ 
      \hline
      \multicolumn{4}{|l|}{Master File Name: #1} \\
      \hline
      Issue & \multicolumn{1}{l|}{Revision} &
        Date & Reason for Change \\
      \hline}

\newcommand\includedfile[1]{%
  \oldaddcontentsline{rev}{includedfile}{#1}}

\newcommand\l@includedfile[2]{%
    \hline
    \end{tabular}
  \end{center}
  \bigskip
  \begin{center}
    \begin{tabular}{|c|c|l|p{8cm}|}
      \hline
      \multicolumn{4}{|l|}{File Revision History} \\
      \hline
      \multicolumn{4}{|l|}{Included File: #1} \\
      \hline
      Issue & \multicolumn{1}{l|}{Revision} &
        Date & Reason for Change \\
      \hline}

\newcommand\l@revclose[2]{%
    \hline
    \end{tabular}
  \end{center}}

\newcommand\version[4]{%
  \oldaddcontentsline{rev}{version}{#1 & #2 & #3 & #4 \\}}

\newcommand\l@version[2]{#1}

\newcommand\documenthistory{%
  \section*{Document History}%
  \@starttoc{rev}}

\newcommand*{\xiipt}{\normalfont\fontsize{12}{14}\selectfont}
\newlength{\hdrsep}
\newlength{\hdrrule}
\setlength{\hdrsep}{5pt}
\setlength{\hdrrule}{1pt}
\definecolor{hdrruleclr}{gray}{.9}
\definecolor{hdrclr}{gray}{.9}

\def\ps@esadoc{\let\@mkboth\@gobbletwo
  \def\@oddhead{%
    \setlength{\fboxsep}{\hdrsep}%
    \setlength{\fboxrule}{\hdrrule}%
    \begin{minipage}[b]{\linewidth}%
      \xiipt%
      \def\arraystretch{1}%
      \setlength{\@tempdima}{\linewidth}%
      \addtolength{\@tempdima}{-2\hdrrule}%
      \addtolength{\@tempdima}{-2\hdrsep}%
      \fcolorbox{hdrruleclr}{hdrclr}{%
        \begin{tabular*}{15.3cm}%
          {@{}l@{\extracolsep{\fill}}l@{\extracolsep{\fill}}l@{}}% 
          \@shorttitle & & \thepage\\%
               \end{tabular*}}\\%
      \mbox{}%
    \end{minipage}\unskip}%
  %\let\@evenhead\@oddhead%
  \def\@oddfoot{}\def\@evenfoot{}%
  \def\sectionmark##1{}\def\subsectionmark##1{}}
% 
% 
\def\@evenhead{%
    \setlength{\fboxsep}{\hdrsep}%
    \setlength{\fboxrule}{\hdrrule}%
    \begin{minipage}[b]{\linewidth}%
      \xiipt%
      \def\arraystretch{1}%
      \setlength{\@tempdima}{\linewidth}%
      \addtolength{\@tempdima}{-2\hdrrule}%
      \addtolength{\@tempdima}{-2\hdrsep}%
      \fcolorbox{hdrruleclr}{hdrclr}{%
        \begin{tabular*}{15.3cm}%
          {@{}l@{\extracolsep{\fill}}l@{\extracolsep{\fill}}l@{}}% 
          \thepage & & \@shorttitle\\%
               \end{tabular*}}\\%
      \mbox{}%
    \end{minipage}\unskip}%
  %\let\@evenhead\@oddhead%
  \def\@oddfoot{}\def\@evenfoot{}%
  \def\sectionmark##1{}\def\subsectionmark##1{}}

\setlength{\headheight}{58\p@}


\setcounter{page}{2}%

\ps@esadoc
\pagenumbering{arabic}

\setlength{\oddsidemargin}{\z@}
\setlength{\evensidemargin}{\z@}
\setlength{\textwidth}{17cm}
\setlength{\textheight}{676\p@}
\setlength{\topmargin}{-1.5cm}

\raggedbottom

%\begin{latexonly}
   \newsavebox{\fmbox}
   \newlength{\adjustedtextwidth}
   \newenvironment{guide}[1]%
     {\begin{lrbox}{\fmbox}
      \setlength{\adjustedtextwidth}{\textwidth}%
      \addtolength{\adjustedtextwidth}{-7pt}%
      % No idea where these 7pt come from...
      \begin{tabular*}{\textwidth}%
        {@{\extracolsep{\fill}}ll@{\extracolsep{0pt}~~}%
        r@{~~~}l@{~~~~~}l@{~~~}r@{~~~}l@{~~}}
      \textbf{Year #1 Courses} &
      \textbf{Fall} & \textbf{C}&\textbf{T} &
      \textbf{Spring}& \textbf{C} & \textbf{T}\\[0.4em]}%
     {\end{tabular*}
      \end{lrbox}
      \framebox{\usebox{\fmbox}}}
%\end{latexonly}

\begin{htmlonly}
   \newenvironment{guide}[1]%
     {\begin{tabular*}{0.8\textwidth}{|c|}
      \hline
      \begin{tabular*}{0.8\textwidth}{l@{\extracolsep{\fill}}llll}
      \textbf{Year #1 Courses} &
      \textbf{Fall} & \textbf{Credits} &
      \textbf{Spring}& \textbf{Credits}\\}%
     {\end{tabular*}
      \hline
      \end{tabular*}}
\end{htmlonly}

\newcommand{\CN}[1]{\hyperlink{#1}{#1}}
\newcommand{\CL}[2]{\hyperlink{#1}{\textit{#2}}}
\newcommand{\ML}[2]{\hyperlink{#1}{\textsc{#2}}}

\newcommand{\module}[5]{%
  % Arguments:
  % #1 - Course Name
  % #2 - Abbreviation
  % #3 - Course Number
  % #4 - Semester
  % #5 - Credit Points
  %
  \subsection*{\CN{#3} -- \hypertarget{#3}{\textsc{#1}}}
  \begin{tabular}{@{}ll}
    \textit{Short Name:}    & #2 \\
    \textit{Semester:}      & #4 \\
    \textit{Credit Points:} & #5
  \end{tabular}
  \paragraph*{General Information}}

\newcommand{\course}[9]{%
  % Arguments:
  % #1 - Course Name
  % #2 - Abbreviation
  % #3 - Course Number
  % #4 - Type
  % #5 - Semester
  % #6 - Credit Points
  % #7 - Prerequisites
  % #8 - Corequisites
  % #9 - Tutorial
  %
  \subsection*{\hypertarget{#3}{#3} -- #1}
  \begin{tabular}{@{}ll}
    \textit{Short Name:}    & #2 \\
    \textit{Type:}          & #4 \\
    \textit{Semester:}      & #5 \\
    \textit{Credit Points:} & #6 \\
    \textit{Prerequisites:} & #7 \\
    \textit{Corequisites:}  & #8 \\
    \textit{Tutorial:}      & #9 
  \end{tabular}
  \paragraph*{Course contents}}

\ifshowresources
  \newenvironment{resources}%[1]%
    {\paragraph*{\textit{Resources}}%
     \begin{list}{}%
       {\renewcommand{\makelabel}[1]{\smash{\parbox[t]{\labelwidth}{##1}}}
        \topsep=\itemsep
        \parskip=0ex
        %\parsep=0ex
        \settowidth{\labelwidth}{\textbf{Textbooks:~}}
        \leftmargin=\labelwidth
        \addtolength{\leftmargin}{\labelsep}}}
    {\end{list}}
  \newcommand{\nl}{\\}
  \newcommand{\NL}{}
  \newcommand{\category}[1]{\item[\textbf{#1}]}
\else%\ifshowresources
  \excludecomment{resources}
\fi%\ifshowresources

\ifshowcurrent
  \newenvironment{current}[1]%
    {\paragraph*{#1}}%
    {}
\else%\ifshowcurrent
  \excludecomment{current}
\fi%\ifshowcurrent

\ifshowprevious
  \newenvironment{previous}[1]%
    {\begin{small} 
       \paragraph*{#1}}
    {\end{small}}
\else%\ifshowprevious
  \excludecomment{previous}
\fi%\ifshowprevious

\def\noheader{\makeatletter\def\@evenhead{\relax}\makeatother}