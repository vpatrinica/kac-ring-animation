%% 
%% This is file `cbar.sty',
%% generated with the docstrip utility.
%% 
%% The original source files were:
%% 
%% cbar.dtx  (with options: `package')
%% 
%% Full documentation can be obtained by LaTeXing the source file: 
%%    cbar.dtx. 
%% 
%% Here, only a few abbreviated comments remain to describe the usage. 
%% 
\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{cbar}
          [1996/03/20 2.2 (PWD)]
 %-------------------------------------------------------------------
 % NOTICE:
 % This file may be used for non-profit purposes.
 % It may not be distributed in exchange for money,
 %   other than distribution costs.
 %
 % The author provides it `as is' and does not guarantee it in any way.
 %
%% Copyright (C) 1994, 1995, 1996 Patrick W. Daly
 % Max-Planck-Institut f\"ur Aeronomie
 % Postfach 20
 % D-37189 Katlenburg-Lindau
 % Germany
 %
 % E-mail:
 % SPAN--     nsp::linmpi::daly    (note nsp also known as ecd1)
 % Internet-- daly@linax1.dnet.gwdg.de
 %-----------------------------------------------------------
 % Primitive change bars
 % Usage:
 %   \PrintBars{n} (in preamble) turns on all bars of level >= n;
 %                 <n> blank for all bars; remove command for no bars
 %   \bar{level}[nl][lift]   prints a bar in margin <nl> lines high, raised
 %                 from current baseline by <lift> (must have dimension)
 %                 <level> is revision number, bar printed if level >= n.
 %   \baroldnew{level}[nl][lift]{old text}{new text}
 %                 same as \bar except <old text> is struck out,
 %                 and <new text> underlined when bar printed;
 %                 without the bar (level < n) only <new text> printed.
 %  Bar style parameters:
 %       \barsep   = space from margin to bar
 %       \barwidth = width of the bar
 %       \OldText{text} = formatting of <old text>
 %       \NewText{text} = formatting of <new text>
 %  LaTeX2e options:
 %     switch         with twoside: bar to left/right for even/odd page
 %     right, left    for margin in which bars always to appear
 %     reverse        for bar to appear in opposite margin to normal
 %     uline          to load package ulem (def), else \baroldnew = \bar)
 %     gray           to load ulem and color, making \NewText =  gray background
 %     altgray        to load ulem and to emulate graying with many dots
 %                       (works without color packages, but LARGE files)
 %     noswitch, noreverse, nouline    undo appropriate option
 % See documentation in the source .dtx file for more details.
 %-----------------------------------------------------------
\newif\ifCBauto \newif\ifCBrev \newif\ifCBtwocol
\newif\ifCBuline
\DeclareOption  {twoside}    {\CBautotrue}
\DeclareOption  {oneside}    {\CBautofalse}
\DeclareOption  {twocolumn}  {\CBtwocoltrue}
\DeclareOption  {onecolumn}  {\CBtwocolfalse}
\DeclareOption  {switch}     {\CBautotrue}
\DeclareOption  {noswitch}   {\CBautofalse}
\DeclareOption  {right}      {\CBautofalse\CBrevfalse}
\DeclareOption  {left}       {\CBautofalse\CBrevtrue}
\DeclareOption  {reverse}    {\CBrevtrue}
\DeclareOption  {noreverse}  {\CBrevfalse}
\DeclareOption  {uline}      {\def\CBuline{1}}
\DeclareOption  {nouline}    {\def\CBuline{0}}
\DeclareOption  {gray}       {\def\CBuline{3}}
\DeclareOption  {altgray}    {\def\CBuline{2}}
\ExecuteOptions{onecolumn,right,uline}
\ProcessOptions
\ifnum\CBuline>0
  \RequirePackage[normalem]{ulem}
\fi
\ifnum\CBuline=3
  \RequirePackage{color}
\fi
\newsavebox{\barbox}
\newlength{\barsep} \setlength{\barsep}{10pt}
\newlength{\barwidth} \setlength{\barwidth}{5pt}
\newlength{\barht} \newlength{\barshift}
\newcounter{barcountlo} \newcounter{barcounthi}
\setcounter{barcountlo}{0} \setcounter{barcounthi}{0}
\newcommand{\PrintBars}[1]{\setcounter{barcountlo}{0}%
     \if!#1!\else\setcounter{barcountlo}{#1}\fi
     \setcounter{barcounthi}{\@M}}
\newcommand{\printbars}[1]{\expandafter\@printbars#1-0-*}

\newcommand{\@printbars}{}
\def\@printbars#1-#2-#3*{%
  \if!#3! \if!#1! \value{barcountlo}=0
                   \setcounter{barcounthi}{\@M}\else
             \setcounter{barcountlo}{#1}%
             \setcounter{barcounthi}{#1}\fi\else
    \if!#1! \setcounter{barcountlo}{0}\setcounter{barcounthi}{#2}\else
          \setcounter{barcountlo}{#1}\setcounter{barcounthi}{#2}\fi\fi}
\@onlypreamble\printbars
\@onlypreamble\PrintBars
\newcommand{\baracc}{}
\let\baracc=\bar
\renewcommand{\bar}{\ifmmode\let\@tempa\baracc\else
                    \let\@tempa\b@r\fi\@tempa}
\newcommand{\b@r}[1]{\@ifnexttok[{\@bar#1}{\@bar#1[]}}

\newcommand{\@bar}{}
\def\@bar#1[#2]{\@ifnexttok[{\@@bar#1[#2]}{\@@bar#1[#2][]}}

\newcommand{\@@bar}{}
\def\@@bar#1[#2][#3]{\@bsphack
  \if!#2!\barht=\baselineskip \else \barht=#2\baselineskip\fi
  \if!#3!\barshift=\z@ \else \barshift=#3\relax \fi
  \ifnum\value{barcountlo}>#1 \else \ifnum\value{barcounthi}<#1 \else
      \dobar \fi\fi \@esphack}
\newcommand{\@ifnexttok}[3]{\let\@tempe #1\def\@tempa{#2}\def
    \@tempb{#3}\futurelet\@tempc\@ifntk}
\newcommand{\@ifntk}{\ifx \@tempc \@tempe\let\@tempd\@tempa\else
    \let\@tempd\@tempb\fi \@tempd}
\newcommand{\dobar}
{\@tempcnta\@ne
 \ifCBtwocol \if@firstcolumn \@tempcnta\m@ne \fi \else
 \ifCBauto \ifodd\value{page} \else \@tempcnta\m@ne \fi \fi
 \ifCBrev \@tempcnta -\@tempcnta \fi \fi
 \savebox{\barbox}
 {\parbox[b][0pt][b]{\hsize}
  {\makebox[\hsize][l]
    {\ifnum\@tempcnta>\z@
      \hspace*{\hsize}\hspace*{\barsep}\else
      \hspace*{-\barsep}\hspace*{-\barwidth}\fi
     \rule[\barshift]{\barwidth}{\barht}}}}%
 \leavevmode \vadjust{\noindent\usebox{\barbox}}%
}
\newcommand{\baroldnew}[1]{\@ifnexttok[{\@baroldnew#1}
                                       {\@baroldnew#1[]}}
\newcommand{\@baroldnew}{}
\def\@baroldnew#1[#2]{\@ifnexttok[{\@@baroldnew#1[#2]}
                                  {\@@baroldnew#1[#2][]}}
\newcommand{\@@baroldnew}{}
\def\@@baroldnew#1[#2][#3]#4#5{\@tempswatrue\ifnum\value{barcountlo}>#1 \else
   \ifnum\value{barcounthi}<#1 \else \@tempswafalse\fi\fi
   \if@tempswa
      \if!#5!\ignorespaces\else #5\fi
   \else
     \if!#4!\else\OldText{#4} \fi \if!#5!\else\NewText{#5}\fi
   \fi\@@bar#1[#2][#3]}
\ifnum\CBuline>0
\newcommand*\CBpxlsz{1} \newcommand*\CBpxlsep{3}
\newbox\ULgray
\newcommand\CBgray{\bgroup \setbox\ULC@box\hbox{(j}%
   \ULdepth=\CBpxlsz\UL@pixel \advance\ULdepth by \CBpxlsep\UL@pixel
   \@tempcnta=\baselineskip \divide\@tempcnta by \ULdepth
   \advance\@tempcnta by \@ne   \ULdepth=\@tempcnta\ULdepth
   \setbox\ULgray\vbox to \z@{\vss\vbox to \ULdepth
      {\leaders\vbox{\hrule width \CBpxlsz\UL@pixel height \CBpxlsz\UL@pixel
          \kern\CBpxlsep\UL@pixel}\vfil}}%
   \markoverwith{\lower\dp\ULC@box\copy\ULgray\kern \CBpxlsep\UL@pixel}\ULon}
\fi
\newcommand*\CBgrayness{.1}
\ifnum\CBuline=3
\definecolor{shade}{gray}{\CBgrayness}
\renewcommand\CBgray{\bgroup \setbox\ULC@box\hbox{(j}%
  \setbox\ULgray\hbox{\vbox to \z@{\vss\hbox{%
     \colorbox{shade}{\vrule \@height\baselineskip \@width\z@}}}}%
   \markoverwith{\lower\dp\ULC@box\copy\ULgray}\ULon}
\fi
\ifcase\CBuline
\newcommand{\OldText}[1]{\relax}
\newcommand{\NewText}[1]{#1}
\or
\newcommand{\OldText}[1]{\sout{#1}}
\newcommand{\NewText}[1]{\uline{#1}}
\else
\newcommand{\OldText}[1]{\sout{#1}}
\newcommand{\NewText}[1]{\CBgray{#1}}
\fi
%% 
%% <<<<< End of decommented file <<<<<< 
%% 
%% End of file `cbar.sty'.
